<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />
  <title>duangor-mail</title>
  <style>
    :root{
      --bg1:#1a1c24;
      --bg2:#2a2f3c;
      --card: rgba(255,255,255,.08);
      --card2: rgba(255,255,255,.06);
      --stroke: rgba(255,255,255,.18);
      --text:#e9ecf3;
      --muted: rgba(233,236,243,.70);
      --gold:#d8b36a;
      --btn: rgba(255,255,255,.10);
      --btn2: rgba(255,255,255,.14);
      --shadow: 0 20px 60px rgba(0,0,0,.35);
      --radius: 26px;
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0;
      font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial;
      color:var(--text);
      background: radial-gradient(1200px 900px at 30% 20%, #3a3450 0%, transparent 60%),
                  radial-gradient(1000px 700px at 80% 30%, #2b4a59 0%, transparent 60%),
                  linear-gradient(180deg, var(--bg2), var(--bg1));
      display:flex;
      align-items:center;
      justify-content:center;
      padding: 24px 16px;
    }
    .wrap{
      width:min(520px, 96vw);
      border-radius: var(--radius);
      background: linear-gradient(180deg, rgba(255,255,255,.07), rgba(255,255,255,.04));
      border: 1px solid var(--stroke);
      box-shadow: var(--shadow);
      padding: 26px 18px 22px;
      position: relative;
      overflow:hidden;
    }
    .wrap:before{
      content:"";
      position:absolute; inset:-40px;
      background: radial-gradient(600px 240px at 40% 15%, rgba(255,255,255,.08), transparent 60%);
      pointer-events:none;
      filter: blur(2px);
    }
    h1{
      margin: 6px 0 8px;
      font-weight: 800;
      letter-spacing: .2px;
      text-align:center;
      font-size: 44px;
      line-height: 1.05;
    }
    .sub{
      text-align:center;
      color: var(--gold);
      font-size: 18px;
      line-height:1.35;
      margin-bottom: 14px;
    }
    .center{display:flex; align-items:center; justify-content:center;}
    .panel{
      margin: 16px auto 0;
      width: min(420px, 92%);
      background: rgba(0,0,0,.18);
      border: 1px solid rgba(255,255,255,.12);
      border-radius: 22px;
      padding: 18px;
    }
    .btn{
      appearance:none; border:1px solid rgba(255,255,255,.18);
      background: var(--btn);
      color: var(--text);
      padding: 14px 20px;
      border-radius: 18px;
      font-weight: 700;
      letter-spacing:.2px;
      cursor:pointer;
      transition: transform .08s ease, background .15s ease, border-color .15s ease;
      box-shadow: 0 10px 30px rgba(0,0,0,.25);
    }
    .btn:hover{ background: var(--btn2); border-color: rgba(255,255,255,.26); }
    .btn:active{ transform: translateY(1px) scale(.99); }

    .pillRow{
      display:flex; gap: 12px; justify-content:center; flex-wrap:wrap;
      margin: 12px 0 10px;
    }
    .pill{
      background: rgba(0,0,0,.18);
      border:1px solid rgba(255,255,255,.14);
      border-radius: 999px;
      padding: 10px 14px;
      color: rgba(233,236,243,.88);
      min-width: 150px;
      text-align:center;
      font-weight:700;
    }
    .hint{
      text-align:center;
      color: rgba(233,236,243,.55);
      margin-top: 10px;
      font-size: 14px;
    }

    /* Envelope */
    .mailBox{
      width:min(360px, 86%);
      aspect-ratio: 1/1;
      border-radius: 22px;
      background: rgba(0,0,0,.14);
      border: 1px solid rgba(255,255,255,.12);
      display:flex;
      align-items:center;
      justify-content:center;
      padding: 18px;
      margin: 10px auto 0;
      position:relative;
    }
    .mailClick{
      cursor:pointer;
      user-select:none;
      -webkit-tap-highlight-color: transparent;
      transform: translateZ(0);
      transition: transform .15s ease;
    }
    .mailClick:active{ transform: scale(.99); }
    .mailText{
      text-align:center;
      margin-top: 12px;
      font-size: 22px;
      font-weight: 800;
      letter-spacing: .2px;
      opacity:0;
      transform: translateY(6px);
      transition: opacity .25s ease, transform .25s ease;
    }
    .mailText.show{ opacity:1; transform: translateY(0); }

    /* Canvas areas */
    .gameWrap{
      width:min(420px, 92%);
      margin: 10px auto 0;
      border-radius: 22px;
      overflow:hidden;
      border:1px solid rgba(255,255,255,.12);
      background: rgba(0,0,0,.18);
      position:relative;
    }
    canvas{ display:block; width:100%; height:auto; }

    /* Confetti */
    .confetti{
      position:absolute; inset:0;
      pointer-events:none;
      overflow:hidden;
    }
    .confetti i{
      position:absolute;
      width:10px; height:16px;
      opacity:.9;
      transform: translateY(-60px) rotate(0deg);
      animation: fall 900ms linear forwards;
      border-radius: 2px;
    }
    @keyframes fall{
      to{ transform: translateY(110vh) rotate(540deg); opacity:1;}
    }

    /* Wheel */
    .wheelWrap{
      width:min(420px, 92%);
      margin: 10px auto 0;
      position:relative;
      border-radius: 22px;
      overflow:hidden;
      border:1px solid rgba(255,255,255,.12);
      background: rgba(0,0,0,.18);
      padding: 14px 14px 18px;
    }
    .pointer{
      position:absolute;
      top: 10px;
      left: 50%;
      transform: translateX(-50%);
      width: 0; height: 0;
      border-left: 14px solid transparent;
      border-right: 14px solid transparent;
      border-bottom: 22px solid #ff4d7d;
      filter: drop-shadow(0 6px 16px rgba(0,0,0,.35));
      z-index: 5;
    }

    /* Swipe pages */
    .pages{
      width:min(420px, 92%);
      margin: 10px auto 0;
      border-radius: 22px;
      overflow:hidden;
      border:1px solid rgba(255,255,255,.12);
      background: rgba(0,0,0,.18);
    }
    .pageInner{
      display:flex;
      width: 600%;
      transform: translateX(0%);
      transition: transform .28s ease;
    }
    .page{
      width: 100%;
      min-height: 420px;
      padding: 18px;
      position:relative;
    }
    .pageTitle{
      font-size: 34px;
      font-weight: 900;
      text-align:center;
      margin: 6px 0 0;
    }
    .pageSub{
      text-align:center;
      color: rgba(233,236,243,.70);
      margin: 8px 0 12px;
      font-weight:700;
    }
    .bigStat{
      margin: 18px auto 0;
      width: 92%;
      border-radius: 18px;
      border:1px solid rgba(255,255,255,.14);
      background: rgba(255,255,255,.05);
      padding: 18px;
      font-size: 24px;
      font-weight: 900;
      text-align:left;
    }
    .pager{
      text-align:center;
      color: rgba(233,236,243,.50);
      padding: 10px 0 0;
      font-weight:700;
    }
  </style>
</head>
<body>
  <div class="wrap" id="app"></div>

  <script>
    // ---------- Audio (file names MUST match your repo exactly) ----------
    const audio = {
      hmmmm: new Audio("hmmmm.mp3"),
      bgm:   new Audio("bgm.mp3"),
      happy: new Audio("happy.mp3"),
      spin:  new Audio("spin.mp3"),
      yay:   new Audio("yay-yay-yay.mp3"),
      yay2:  new Audio("yay.mp3")
    };

    // Set loops
    audio.bgm.loop = true;
    audio.happy.loop = true;

    // Safe play helper (prevents iOS errors)
    async function safePlay(a, {volume=1, restart=false}={}){
      try{
        if(restart) a.currentTime = 0;
        a.volume = Math.max(0, Math.min(1, volume));
        await a.play();
        return true;
      }catch(e){
        return false;
      }
    }
    function safePause(a){
      try{ a.pause(); }catch(e){}
    }

    // Choose yay file gracefully
    async function playYay(){
      // try yay-yay-yay first, if missing, fallback to yay.mp3
      const ok = await safePlay(audio.yay, {volume:1, restart:true});
      if(!ok) await safePlay(audio.yay2, {volume:1, restart:true});
    }

    // Global state
    const app = document.getElementById("app");
    let current = "mail"; // mail -> game -> wheel -> aha -> luck
    let gameWon = false;

    // ---------- UI RENDER ----------
    function renderMail(){
      current = "mail";
      app.innerHTML = `
        <h1>Dear Mr Wong<br/>Duan Chiang,</h1>
        <div class="sub">Have you turned your audio on? Click on the envelope.</div>

        <div class="mailBox">
          <div class="mailClick" id="mailBtn" aria-label="Open mail">
            ${niceEnvelopeSVG()}
          </div>
        </div>

        <div class="mailText" id="mailText">You‚Äôve got a mail!</div>
      `;

      const btn = document.getElementById("mailBtn");
      const mailText = document.getElementById("mailText");

      btn.addEventListener("click", async () => {
        // Start happy background at A (must be user gesture to satisfy iOS autoplay)
        await safePlay(audio.happy, {volume: 0.55, restart:false});

        // Play hmmmm exactly on click
        await safePlay(audio.hmmmm, {volume: 1, restart:true});

        // Open envelope (CSS/attribute toggle)
        btn.querySelector("svg").setAttribute("data-open", "1");
        mailText.classList.add("show");

        // Move to game after 1.5s
        setTimeout(() => renderGame(), 1500);
      });
    }

    // ---------- GAME (Flappy-ish, boy jersey 27 + "dcop" above) ----------
    let game = null;

    function renderGame(){
  current = "game";

  // stop happy while playing
  safePause(audio.happy);

  app.innerHTML = `
    <h1>How OP are you? <span style="font-size:.7em">üéÆ</span></h1>
    <div class="sub" style="color:rgba(233,236,243,.78)">
      <div><span style="color:var(--gold)">Reach 11</span> to win the game.</div>
      <div>Tap <b>Start</b> to start the game.</div>
      <div>Tap screen to <b>jump</b>.</div>
    </div>

    <div class="pillRow">
      <div class="pill">Player: <b>dcop</b></div>
      <div class="pill">Score: <b id="scoreTxt">0</b>/11</div>
      <div class="pill" id="statusPill">Goal: <b>11</b></div>
    </div>

    <div class="gameWrap">
      <canvas id="gameCanvas" width="520" height="360"></canvas>
    </div>

    <div class="center" style="margin-top:14px;">
      <button class="btn" id="startBtn">Start</button>
    </div>
    <div class="hint" id="gameMsg">Tap the screen to jump.</div>
  `;

  const canvas = document.getElementById("gameCanvas");
  const ctx = canvas.getContext("2d");
  const scoreTxt = document.getElementById("scoreTxt");
  const statusPill = document.getElementById("statusPill");
  const gameMsg = document.getElementById("gameMsg");
  const startBtn = document.getElementById("startBtn");

  let running = false;
  let last = performance.now();
  let score = 0;

  const groundY = 300;
  const gravity = 1200;
  const jumpV = -520;
  const speed = 260;
  const targetScore = 11;

  // boy proportions (your non-nego)
  const p = { x: 120, y: groundY, vy: 0, w: 28, h: 44, onGround: true };
  let spikes = [];
  let spawnTimer = 0;

  // hearts burst on win
  let hearts = [];
  function spawnHearts(){
    hearts = [];
    for(let i=0;i<18;i++){
      hearts.push({
        x: p.x + 4 + Math.random()*20,
        y: (p.y - p.h) - 10 + Math.random()*10,
        vx: -80 + Math.random()*160,
        vy: -220 - Math.random()*180,
        life: 0.9 + Math.random()*0.6
      });
    }
  }

  function resetGame(){
    running = false;
    last = performance.now();
    score = 0;
    scoreTxt.textContent = "0";
    statusPill.textContent = "Goal: 11";
    gameMsg.textContent = "Tap the screen to jump.";
    p.y = groundY; p.vy = 0; p.onGround = true;
    spikes = [];
    spawnTimer = 0;
    hearts = [];
    draw();
  }

  function jump(){
    if(!running) return;
    if(p.onGround){
      p.vy = jumpV;
      p.onGround = false;
    }
  }

  function spawnSpike(){
    spikes.push({ x: 560, w: 26, h: 34, passed: false });
  }

  function collideRect(ax,ay,aw,ah, bx,by,bw,bh){
    return ax < bx + bw && ax + aw > bx && ay < by + bh && ay + ah > by;
  }

  function lose(){
    running = false;
    statusPill.textContent = "Try again üò≠";
    gameMsg.textContent = "You touched a spike. Press Start and try again.";
  }

  function win(){
    running = false;
    statusPill.textContent = "WIN ‚úÖ";
    gameMsg.textContent = "Damn, you‚Äôre an 11/10 indeed!";
    spawnHearts();

    // LOWER BGM by 50% AFTER game ends (your requirement)
    audio.bgm.volume = 0.5;

    // continue to wheel after a short beat
    setTimeout(() => renderWheel(), 900);
  }

  function update(dt){
    p.vy += gravity * dt;
    p.y += p.vy * dt;

    if(p.y >= groundY){
      p.y = groundY;
      p.vy = 0;
      p.onGround = true;
    }

    spawnTimer -= dt;
    if(spawnTimer <= 0){
      spawnSpike();
      spawnTimer = 0.8 + Math.random() * 0.65;
    }

    spikes.forEach(s => s.x -= speed * dt);
    spikes = spikes.filter(s => s.x > -80);

    for(const s of spikes){
      if(!s.passed && s.x + s.w < p.x){
        s.passed = true;
        score++;
        scoreTxt.textContent = String(score);
        if(score >= targetScore){
          win();
          return;
        }
      }
    }

    for(const s of spikes){
      const spikeX = s.x;
      const spikeY = groundY - s.h;
      const hit = collideRect(p.x, p.y - p.h, p.w, p.h, spikeX+3, spikeY+6, s.w-6, s.h-6);
      if(hit){ lose(); return; }
    }

    // hearts
    hearts.forEach(h => {
      h.life -= dt;
      h.vy += 600 * dt;
      h.x += h.vx * dt;
      h.y += h.vy * dt;
    });
    hearts = hearts.filter(h => h.life > 0);

    draw();
  }

  function drawHeart(x,y){
    ctx.fillStyle = "rgba(255,214,231,.95)";
    ctx.fillRect(x, y, 3, 3);
    ctx.fillRect(x+6, y, 3, 3);
    ctx.fillRect(x-3, y+3, 3, 3);
    ctx.fillRect(x+3, y+3, 3, 3);
    ctx.fillRect(x+9, y+3, 3, 3);
    ctx.fillRect(x, y+6, 3, 3);
    ctx.fillRect(x+6, y+6, 3, 3);
    ctx.fillRect(x+3, y+9, 3, 3);
  }

  // Non-nego pixel boy: black fringe + white shirt ‚Äú27‚Äù + "dcop"
  function drawPixelBoy(){
    const x = p.x, y = p.y;
    const top = y - p.h;

    // shadow
    ctx.fillStyle = "rgba(0,0,0,.35)";
    ctx.fillRect(x+3, y+6, 22, 6);

    // legs/pants
    ctx.fillStyle = "#1d1d33";
    ctx.fillRect(x+6, top+28, 7, 14);
    ctx.fillRect(x+15, top+28, 7, 14);

    // shoes
    ctx.fillStyle = "#0b0b10";
    ctx.fillRect(x+5, top+42, 9, 2);
    ctx.fillRect(x+14, top+42, 9, 2);

    // shirt (white)
    ctx.fillStyle = "#f6f6ff";
    ctx.fillRect(x+5, top+18, 18, 12);

    // arms (skin)
    ctx.fillStyle = "#f1d0b5";
    ctx.fillRect(x+3, top+20, 3, 8);
    ctx.fillRect(x+23, top+20, 3, 8);

    // head (skin)
    ctx.fillStyle = "#f1d0b5";
    ctx.fillRect(x+7, top+4, 14, 14);

    // hair (black fringe)
    ctx.fillStyle = "#0b0b10";
    ctx.fillRect(x+6, top+2, 16, 6);
    ctx.fillRect(x+6, top+7, 4, 4);
    ctx.fillRect(x+10, top+7, 4, 3);
    ctx.fillRect(x+14, top+7, 4, 4);
    ctx.fillRect(x+18, top+7, 4, 3);

    // eyes
    ctx.fillStyle = "#000";
    ctx.fillRect(x+11, top+10, 2, 2);
    ctx.fillRect(x+17, top+10, 2, 2);

    // ‚Äú27‚Äù
    ctx.fillStyle = "#0b0b10";
    ctx.font = "10px system-ui";
    ctx.fillText("27", x+10, top+27);

    // name tag
    ctx.font = "12px system-ui";
    ctx.fillStyle = "rgba(255,255,255,.92)";
    ctx.fillText("dcop", x+1, top-6);
  }

  function drawSpike(s){
    const spikeX = s.x, baseY = groundY, h = s.h, w = s.w;
    ctx.fillStyle = "rgba(255,255,255,0.10)";
    ctx.beginPath();
    ctx.moveTo(spikeX, baseY);
    ctx.lineTo(spikeX + w/2, baseY - h);
    ctx.lineTo(spikeX + w, baseY);
    ctx.closePath();
    ctx.fill();
    ctx.strokeStyle = "rgba(255,255,255,0.16)";
    ctx.stroke();
  }

  function draw(){
    ctx.clearRect(0,0,520,360);

    // bg
    ctx.fillStyle = "rgba(0,0,0,.18)";
    ctx.fillRect(0,0,520,360);

    // subtle stars
    ctx.fillStyle = "rgba(255,255,255,.08)";
    for(let i=0;i<30;i++) ctx.fillRect((i*73)%520, (i*41)%260, 2, 2);

    // ground
    ctx.fillStyle = "rgba(0,0,0,.22)";
    ctx.fillRect(0, groundY, 520, 60);
    ctx.fillStyle = "rgba(255,255,255,.10)";
    ctx.fillRect(0, groundY, 520, 2);

    spikes.forEach(drawSpike);
    drawPixelBoy();
    hearts.forEach(h => drawHeart(h.x, h.y));
  }

  function loop(now){
    const dt = Math.min(0.033, (now - last)/1000);
    last = now;
    if(running) update(dt);
    requestAnimationFrame(loop);
  }
  requestAnimationFrame(loop);

  startBtn.addEventListener("click", async () => {
    resetGame();
    running = true;
    statusPill.textContent = "Goal: 11";

    // Start bgm only after Start (user gesture)
    await safePlay(audio.bgm, {volume: 1, restart:false});
  });

  canvas.addEventListener("pointerdown", (e) => { e.preventDefault(); jump(); });
  canvas.addEventListener("touchstart", (e) => { e.preventDefault(); jump(); }, {passive:false});

  resetGame();
}


    // ---------- WHEEL ----------
    function renderWheel(){
      current = "wheel";

      app.innerHTML = `
        <h1>Spin to win <span style="font-size:.7em">üé°</span></h1>
        <div class="sub" style="color:rgba(233,236,243,.75)">No backing out now.</div>

        <div class="wheelWrap">
          <div class="pointer"></div>
          <canvas id="wheelCanvas" width="420" height="420"></canvas>
        </div>

        <div class="center" style="margin-top:14px;">
          <button class="btn" id="spinBtn">SPIN</button>
        </div>
      `;

      const canvas = document.getElementById("wheelCanvas");
      const ctx = canvas.getContext("2d");
      const spinBtn = document.getElementById("spinBtn");

      const segments = [
        "WILD CARD",
        "DATE NIGHT PLANNING",
        "FREE MASSAGE FOR GF",
        "OMYUM RAMEN ON",
        "X MINS ONYX"
      ];

      // We will FORCE land on WILD CARD to guarantee
      const forcedIndex = 0;

      let angle = 0;
      let spinning = false;

      function drawWheel(){
        const W = canvas.width, H = canvas.height;
        const cx = W/2, cy = H/2;
        const rOuter = 190;
        const rInner = 46;
        const n = segments.length;
        const slice = (Math.PI*2)/n;

        ctx.clearRect(0,0,W,H);

        // Outer ring
        ctx.beginPath();
        ctx.arc(cx,cy,rOuter+8,0,Math.PI*2);
        ctx.strokeStyle="rgba(255,255,255,.14)";
        ctx.lineWidth=2;
        ctx.stroke();

        for(let i=0;i<n;i++){
          const a0 = angle + i*slice;
          const a1 = a0 + slice;

          // Segment fill
          ctx.beginPath();
          ctx.moveTo(cx,cy);
          ctx.arc(cx,cy,rOuter,a0,a1);
          ctx.closePath();

          ctx.fillStyle = (i%2===0) ? "rgba(255,255,255,.08)" : "rgba(255,255,255,.05)";
          ctx.fill();
          ctx.strokeStyle="rgba(255,255,255,.12)";
          ctx.lineWidth=2;
          ctx.stroke();

          // Text
          const mid = (a0+a1)/2;
          ctx.save();
          ctx.translate(cx,cy);
          ctx.rotate(mid);

          // We draw text centered along radial direction, keeping it readable
          const label = segments[i];
          const lines = wrapLabel(label, 14); // auto-wrap
          ctx.textAlign="center";
          ctx.fillStyle="rgba(233,236,243,.90)";
          ctx.font="900 16px ui-sans-serif, system-ui";
          const ty = -120;

          if(lines.length === 1){
            ctx.fillText(lines[0], 0, ty);
          }else{
            ctx.fillText(lines[0], 0, ty-10);
            ctx.fillText(lines[1], 0, ty+10);
          }

          ctx.restore();
        }

        // center hub
        ctx.beginPath();
        ctx.arc(cx,cy,rInner,0,Math.PI*2);
        ctx.fillStyle="rgba(0,0,0,.30)";
        ctx.fill();
        ctx.strokeStyle="rgba(255,255,255,.12)";
        ctx.lineWidth=2;
        ctx.stroke();
      }

      drawWheel();

      function angleForIndex(i){
        const n = segments.length;
        const slice = (Math.PI*2)/n;

        // Pointer is at top. We want chosen segment centered at top.
        const targetMid = -Math.PI/2; // top
        const segMid = i*slice + slice/2;
        return targetMid - segMid;
      }

      spinBtn.addEventListener("click", async () => {
        if(spinning) return;
        spinning = true;
        spinBtn.disabled = true;

        // wheel sound
        await safePlay(audio.spin, {volume: 1, restart:true});

        // animate spin and land on forcedIndex
        const base = angleForIndex(forcedIndex);
        const extraTurns = 6; // for drama
        const startA = angle;
        const endA = base + extraTurns*Math.PI*2;

        const dur = 3200;
        const t0 = performance.now();

        function easeOutCubic(x){ return 1 - Math.pow(1-x, 3); }

        function anim(t){
          const p = Math.min(1, (t - t0)/dur);
          angle = startA + (endA - startA) * easeOutCubic(p);
          drawWheel();
          if(p < 1){
            requestAnimationFrame(anim);
          }else{
            spinning = false;
            spinBtn.disabled = false;

            // stop spin sound
            safePause(audio.spin);

            // Confetti + button ‚ÄúWild card? Hmmmm‚Äù
            doConfetti(document.querySelector(".wheelWrap"));

            setTimeout(async () => {
              await playYay();
              showWildCardButton();
            }, 250);
          }
        }
        requestAnimationFrame(anim);
      });

      function showWildCardButton(){
        const c = document.querySelector(".wheelWrap");
        const holder = document.createElement("div");
        holder.className="center";
        holder.style.marginTop="14px";
        holder.innerHTML = `<button class="btn" id="wildBtn">Wild card? Hmmmm</button>`;
        c.insertAdjacentElement("afterend", holder);

        holder.querySelector("#wildBtn").addEventListener("click", () => {
          holder.remove();
          renderAha();
        });
      }
    }

    // ---------- AHA PAGE ----------
    function renderAha(){
      current = "aha";

      app.innerHTML = `
        <h1 style="font-size:40px">Aha! Thought you were lucky? I‚Äôm the luckier one.</h1>
        <div class="sub" style="color:rgba(233,236,243,.72)">Click to check your luck stats</div>

        <div class="center" style="margin-top:18px;">
          <button class="btn" id="luckBtn">Click to check your luck stats</button>
        </div>
      `;

      document.getElementById("luckBtn").addEventListener("click", () => {
        renderLuckPages();
      });
    }

    // ---------- LUCK PAGES (1-5) ----------
    function renderLuckPages(){
      current = "luck";

      // At this point: stop bgm completely, happy only
      safePause(audio.bgm);
      safePlay(audio.happy, {volume: 0.80, restart:false});

      app.innerHTML = `
        <h1 style="font-size:40px">üìä Luck Stats Report</h1>
        <div class="sub" style="color:rgba(233,236,243,.72)">Swipe left/right.</div>

        <div class="pages" id="pages">
          <div class="pageInner" id="pageInner">
            ${luckPage("Luck stat: 1", "1 / 5")}
            ${luckPage("Luck stat increasing‚Ä¶ 2", "2 / 5")}
            ${luckPage("Luck stat increasing more‚Ä¶ 3", "3 / 5")}
            ${luckPage("Luck stat increasing morer‚Ä¶ 4", "4 / 5")}
            ${luckPage("Luck stat increasing morerest‚Ä¶ 5", "5 / 5")}
          </div>
        </div>

        <div class="pager" id="pager">1 / 5</div>
      `;

      const inner = document.getElementById("pageInner");
      const pager = document.getElementById("pager");
      let idx = 0;

      function update(){
        inner.style.transform = `translateX(${-idx*100}%)`;
        pager.textContent = `${idx+1} / 5`;
      }

      // Swipe handling
      let startX = null;
      const pages = document.getElementById("pages");

      pages.addEventListener("touchstart", (e) => {
        startX = e.touches[0].clientX;
      }, {passive:true});

      pages.addEventListener("touchend", (e) => {
        if(startX === null) return;
        const endX = (e.changedTouches[0] || {}).clientX;
        const dx = endX - startX;
        startX = null;
        if(Math.abs(dx) < 40) return;
        if(dx < 0 && idx < 4) idx++;
        if(dx > 0 && idx > 0) idx--;
        update();
      }, {passive:true});

      // Desktop fallback
      pages.addEventListener("click", () => {
        if(idx < 4) idx++;
        else idx = 0;
        update();
      });

      update();
    }

    function luckPage(text, footer){
      return `
        <div class="page">
          <div class="bigStat">${text}</div>
        </div>
      `;
    }

    // ---------- Helpers ----------
    function roundRect(ctx, x, y, w, h, r){
      const rr = Math.min(r, w/2, h/2);
      ctx.moveTo(x+rr, y);
      ctx.arcTo(x+w, y, x+w, y+h, rr);
      ctx.arcTo(x+w, y+h, x, y+h, rr);
      ctx.arcTo(x, y+h, x, y, rr);
      ctx.arcTo(x, y, x+w, y, rr);
    }

    function wrapLabel(label, maxLen){
      // Return up to 2 lines, tries to break on spaces
      const words = label.split(" ");
      let line1 = "";
      let line2 = "";

      for(const w of words){
        const test = (line1 ? line1 + " " : "") + w;
        if(test.length <= maxLen){
          line1 = test;
        }else{
          line2 = (line2 ? line2 + " " : "") + w;
        }
      }

      if(!line2) return [line1];
      // If line2 still too long, hard cut (rare)
      if(line2.length > maxLen) line2 = line2.slice(0, maxLen-1) + "‚Ä¶";
      return [line1, line2];
    }

    function doConfetti(container){
      const layer = document.createElement("div");
      layer.className = "confetti";
      container.appendChild(layer);

      const colors = ["#ff4d7d","#ffd166","#7bdff2","#b8f2a6","#cdb4ff"];
      for(let i=0;i<32;i++){
        const p = document.createElement("i");
        p.style.left = (Math.random()*100)+"%";
        p.style.top = (-20 - Math.random()*120)+"px";
        p.style.background = colors[i%colors.length];
        p.style.animationDelay = (Math.random()*120)+"ms";
        p.style.transform = `translateY(-60px) rotate(${Math.random()*90}deg)`;
        layer.appendChild(p);
      }
      setTimeout(()=> layer.remove(), 1100);
    }

    function niceEnvelopeSVG(){
      // A nicer envelope with subtle gradients + clean flap open animation.
      return `
      <svg width="300" height="300" viewBox="0 0 300 300" role="img" aria-label="Envelope"
           style="overflow:visible" data-open="0">
        <defs>
          <linearGradient id="g1" x1="0" x2="1">
            <stop offset="0" stop-color="rgba(255,255,255,.18)"/>
            <stop offset="1" stop-color="rgba(255,255,255,.08)"/>
          </linearGradient>
          <linearGradient id="g2" x1="0" x2="0" y1="0" y2="1">
            <stop offset="0" stop-color="rgba(0,0,0,.10)"/>
            <stop offset="1" stop-color="rgba(0,0,0,.28)"/>
          </linearGradient>
          <filter id="sh" x="-20%" y="-20%" width="140%" height="140%">
            <feDropShadow dx="0" dy="12" stdDeviation="10" flood-color="rgba(0,0,0,.35)"/>
          </filter>
        </defs>

        <!-- Back plate -->
        <rect x="30" y="70" width="240" height="170" rx="26"
              fill="rgba(0,0,0,.18)" stroke="rgba(255,255,255,.14)" filter="url(#sh)"/>

        <!-- Envelope body -->
        <g transform="translate(0,0)">
          <rect x="55" y="110" width="190" height="120" rx="18"
                fill="url(#g2)" stroke="rgba(255,255,255,.18)" stroke-width="2"/>

          <!-- X lines -->
          <path d="M65 120 L150 185 L235 120" fill="none" stroke="rgba(255,255,255,.20)" stroke-width="2"/>
          <path d="M65 220 L150 155 L235 220" fill="none" stroke="rgba(255,255,255,.14)" stroke-width="2"/>

          <!-- Flap (animated) -->
          <g id="flap" transform-origin="150px 122px"
             style="transition: transform 320ms cubic-bezier(.2,.9,.2,1)">
            <path d="M65 120 L150 70 L235 120 Z"
                  fill="url(#g1)" stroke="rgba(255,255,255,.22)" stroke-width="2"/>
          </g>

          <!-- Heart seal -->
          <g transform="translate(150,205)">
            <path d="M0 18
                     C-18 6 -26 -8 -12 -18
                     C-4 -24 0 -18 0 -14
                     C0 -18 4 -24 12 -18
                     C26 -8 18 6 0 18 Z"
                  fill="#ff4d7d" opacity=".95"/>
            <path d="M0 18
                     C-18 6 -26 -8 -12 -18
                     C-4 -24 0 -18 0 -14
                     C0 -18 4 -24 12 -18
                     C26 -8 18 6 0 18 Z"
                  fill="none" stroke="rgba(255,255,255,.25)" stroke-width="2"/>
          </g>
        </g>

        <style>
          svg[data-open="1"] #flap { transform: rotateX(65deg) translateY(-6px); }
        </style>
      </svg>`;
    }

    // ---------- Start ----------
    renderMail();
  </script>
</body>
</html>
