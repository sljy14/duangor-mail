<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />
  <title>duangor-mail</title>
  <style>
    :root{
      --bg1:#1a1c24;
      --bg2:#2a2f3c;
      --card: rgba(255,255,255,.08);
      --card2: rgba(255,255,255,.06);
      --stroke: rgba(255,255,255,.18);
      --text:#e9ecf3;
      --muted: rgba(233,236,243,.70);
      --gold:#d8b36a;
      --btn: rgba(255,255,255,.10);
      --btn2: rgba(255,255,255,.14);
      --shadow: 0 20px 60px rgba(0,0,0,.35);
      --radius: 26px;
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0;
      font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial;
      color:var(--text);
      background: radial-gradient(1200px 900px at 30% 20%, #3a3450 0%, transparent 60%),
                  radial-gradient(1000px 700px at 80% 30%, #2b4a59 0%, transparent 60%),
                  linear-gradient(180deg, var(--bg2), var(--bg1));
      display:flex;
      align-items:center;
      justify-content:center;
      padding: 24px 16px;
    }
    .wrap{
      width:min(520px, 96vw);
      border-radius: var(--radius);
      background: linear-gradient(180deg, rgba(255,255,255,.07), rgba(255,255,255,.04));
      border: 1px solid var(--stroke);
      box-shadow: var(--shadow);
      padding: 26px 18px 22px;
      position: relative;
      overflow:hidden;
    }
    .wrap:before{
      content:"";
      position:absolute; inset:-40px;
      background: radial-gradient(600px 240px at 40% 15%, rgba(255,255,255,.08), transparent 60%);
      pointer-events:none;
      filter: blur(2px);
    }
    h1{
      margin: 6px 0 8px;
      font-weight: 800;
      letter-spacing: .2px;
      text-align:center;
      font-size: 44px;
      line-height: 1.05;
    }
    .sub{
      text-align:center;
      color: var(--gold);
      font-size: 18px;
      line-height:1.35;
      margin-bottom: 14px;
    }
    .center{display:flex; align-items:center; justify-content:center;}
    .panel{
      margin: 16px auto 0;
      width: min(420px, 92%);
      background: rgba(0,0,0,.18);
      border: 1px solid rgba(255,255,255,.12);
      border-radius: 22px;
      padding: 18px;
    }
    .btn{
      appearance:none; border:1px solid rgba(255,255,255,.18);
      background: var(--btn);
      color: var(--text);
      padding: 14px 20px;
      border-radius: 18px;
      font-weight: 700;
      letter-spacing:.2px;
      cursor:pointer;
      transition: transform .08s ease, background .15s ease, border-color .15s ease;
      box-shadow: 0 10px 30px rgba(0,0,0,.25);
    }
    .btn:hover{ background: var(--btn2); border-color: rgba(255,255,255,.26); }
    .btn:active{ transform: translateY(1px) scale(.99); }

    .pillRow{
      display:flex; gap: 12px; justify-content:center; flex-wrap:wrap;
      margin: 12px 0 10px;
    }
    .pill{
      background: rgba(0,0,0,.18);
      border:1px solid rgba(255,255,255,.14);
      border-radius: 999px;
      padding: 10px 14px;
      color: rgba(233,236,243,.88);
      min-width: 150px;
      text-align:center;
      font-weight:700;
    }
    .hint{
      text-align:center;
      color: rgba(233,236,243,.55);
      margin-top: 10px;
      font-size: 14px;
    }

    /* Envelope */
    .mailBox{
      width:min(360px, 86%);
      aspect-ratio: 1/1;
      border-radius: 22px;
      background: rgba(0,0,0,.14);
      border: 1px solid rgba(255,255,255,.12);
      display:flex;
      align-items:center;
      justify-content:center;
      padding: 18px;
      margin: 10px auto 0;
      position:relative;
    }
    .mailClick{
      cursor:pointer;
      user-select:none;
      -webkit-tap-highlight-color: transparent;
      transform: translateZ(0);
      transition: transform .15s ease;
    }
    .mailClick:active{ transform: scale(.99); }
    .mailText{
      text-align:center;
      margin-top: 12px;
      font-size: 22px;
      font-weight: 800;
      letter-spacing: .2px;
      opacity:0;
      transform: translateY(6px);
      transition: opacity .25s ease, transform .25s ease;
    }
    .mailText.show{ opacity:1; transform: translateY(0); }

    /* Canvas areas */
    .gameWrap{
      width:min(420px, 92%);
      margin: 10px auto 0;
      border-radius: 22px;
      overflow:hidden;
      border:1px solid rgba(255,255,255,.12);
      background: rgba(0,0,0,.18);
      position:relative;
    }
    canvas{ display:block; width:100%; height:auto; }

    /* Confetti */
    .confetti{
      position:absolute; inset:0;
      pointer-events:none;
      overflow:hidden;
    }
    .confetti i{
      position:absolute;
      width:10px; height:16px;
      opacity:.9;
      transform: translateY(-60px) rotate(0deg);
      animation: fall 900ms linear forwards;
      border-radius: 2px;
    }
    @keyframes fall{
      to{ transform: translateY(110vh) rotate(540deg); opacity:1;}
    }

    /* Wheel */
    .wheelWrap{
      width:min(420px, 92%);
      margin: 10px auto 0;
      position:relative;
      border-radius: 22px;
      overflow:hidden;
      border:1px solid rgba(255,255,255,.12);
      background: rgba(0,0,0,.18);
      padding: 14px 14px 18px;
    }
    .pointer{
      position:absolute;
      top: 10px;
      left: 50%;
      transform: translateX(-50%);
      width: 0; height: 0;
      border-left: 14px solid transparent;
      border-right: 14px solid transparent;
      border-bottom: 22px solid #ff4d7d;
      filter: drop-shadow(0 6px 16px rgba(0,0,0,.35));
      z-index: 5;
    }

    /* Swipe pages */
    .pages{
      width:min(420px, 92%);
      margin: 10px auto 0;
      border-radius: 22px;
      overflow:hidden;
      border:1px solid rgba(255,255,255,.12);
      background: rgba(0,0,0,.18);
    }
    .pageInner{
      display:flex;
      width: 600%;
      transform: translateX(0%);
      transition: transform .28s ease;
    }
    .page{
      width: 100%;
      min-height: 420px;
      padding: 18px;
      position:relative;
    }
    .pageTitle{
      font-size: 34px;
      font-weight: 900;
      text-align:center;
      margin: 6px 0 0;
    }
    .pageSub{
      text-align:center;
      color: rgba(233,236,243,.70);
      margin: 8px 0 12px;
      font-weight:700;
    }
    .bigStat{
      margin: 18px auto 0;
      width: 92%;
      border-radius: 18px;
      border:1px solid rgba(255,255,255,.14);
      background: rgba(255,255,255,.05);
      padding: 18px;
      font-size: 24px;
      font-weight: 900;
      text-align:left;
    }
    .pager{
      text-align:center;
      color: rgba(233,236,243,.50);
      padding: 10px 0 0;
      font-weight:700;
    }
  </style>
</head>
<body>
  <div class="wrap" id="app"></div>

  <script>
    // ---------- Audio (file names MUST match your repo exactly) ----------
    const audio = {
      hmmmm: new Audio("hmmmm.mp3"),
      bgm:   new Audio("bgm.mp3"),
      happy: new Audio("happy.mp3"),
      spin:  new Audio("spin.mp3"),
      yay:   new Audio("yay-yay-yay.mp3"),
      yay2:  new Audio("yay.mp3")
    };

    // Set loops
    audio.bgm.loop = true;
    audio.happy.loop = true;

    // Safe play helper (prevents iOS errors)
    async function safePlay(a, {volume=1, restart=false}={}){
      try{
        if(restart) a.currentTime = 0;
        a.volume = Math.max(0, Math.min(1, volume));
        await a.play();
        return true;
      }catch(e){
        return false;
      }
    }
    function safePause(a){
      try{ a.pause(); }catch(e){}
    }

    // Choose yay file gracefully
    async function playYay(){
      // try yay-yay-yay first, if missing, fallback to yay.mp3
      const ok = await safePlay(audio.yay, {volume:1, restart:true});
      if(!ok) await safePlay(audio.yay2, {volume:1, restart:true});
    }

    // Global state
    const app = document.getElementById("app");
    let current = "mail"; // mail -> game -> wheel -> aha -> luck
    let gameWon = false;

    // ---------- UI RENDER ----------
    function renderMail(){
      current = "mail";
      app.innerHTML = `
        <h1>Dear Mr Wong<br/>Duan Chiang,</h1>
        <div class="sub">Have you turned your audio on? Click on the envelope.</div>

        <div class="mailBox">
          <div class="mailClick" id="mailBtn" aria-label="Open mail">
            ${niceEnvelopeSVG()}
          </div>
        </div>

        <div class="mailText" id="mailText">Youâ€™ve got a mail!</div>
      `;

      const btn = document.getElementById("mailBtn");
      const mailText = document.getElementById("mailText");

      btn.addEventListener("click", async () => {
        // Start happy background at A (must be user gesture to satisfy iOS autoplay)
        await safePlay(audio.happy, {volume: 0.55, restart:false});

        // Play hmmmm exactly on click
        await safePlay(audio.hmmmm, {volume: 1, restart:true});

        // Open envelope (CSS/attribute toggle)
        btn.querySelector("svg").setAttribute("data-open", "1");
        mailText.classList.add("show");

        // Move to game after 1.5s
        setTimeout(() => renderGame(), 1500);
      });
    }

    // ---------- GAME (Flappy-ish, boy jersey 27 + "dcop" above) ----------
    let game = null;

    function renderGame(){
      current = "game";
      // Stop/quiet happy while playing the game
      safePause(audio.happy);

      app.innerHTML = `
        <h1>How OP are you? <span style="font-size:.7em">ðŸŽ®</span></h1>
        <div class="sub" style="color:rgba(233,236,243,.78)">
          <div><span style="color:var(--gold)">Reach 11</span> to win the game.</div>
          <div>Tap <b>Start</b> to start the game.</div>
          <div>Tap screen to <b>jump</b>.</div>
        </div>

        <div class="pillRow">
          <div class="pill">Player: <b>dcop</b></div>
          <div class="pill">Score: <b id="scoreTxt">0/11</b></div>
          <div class="pill">Goal: <b>11</b></div>
        </div>

        <div class="gameWrap">
          <canvas id="gameCanvas" width="420" height="520"></canvas>
        </div>

        <div class="center" style="margin-top:14px;">
          <button class="btn" id="startBtn">Start</button>
        </div>
        <div class="hint">Tip: tap anywhere to jump.</div>
      `;

      const canvas = document.getElementById("gameCanvas");
      const ctx = canvas.getContext("2d");
      const scoreTxt = document.getElementById("scoreTxt");
      const startBtn = document.getElementById("startBtn");

      // Game state
      const W = canvas.width, H = canvas.height;
      const groundY = H - 60;

      const player = {
        x: 110, y: 220, vy: 0,
        r: 18
      };

      let pipes = [];
      let score = 0;
      let running = false;
      let lastTime = 0;
      let spawnT = 0;

      function reset(){
        player.y = 220; player.vy = 0;
        pipes = [];
        score = 0;
        scoreTxt.textContent = `${score}/11`;
        gameWon = false;
        spawnT = 0;
      }

      function spawnPipe(){
        const gap = 150;
        const minTop = 80;
        const maxTop = groundY - 80 - gap;
        const topH = Math.floor(minTop + Math.random()*(maxTop - minTop));
        pipes.push({
          x: W + 40,
          w: 64,
          topH,
          gap,
          passed: false
        });
      }

      function collideRectCircle(rx, ry, rw, rh, cx, cy, cr){
        const nx = Math.max(rx, Math.min(cx, rx+rw));
        const ny = Math.max(ry, Math.min(cy, ry+rh));
        const dx = cx - nx;
        const dy = cy - ny;
        return (dx*dx + dy*dy) <= cr*cr;
      }

      function drawBackground(){
        // Soft gradient background
        const g = ctx.createLinearGradient(0,0,0,H);
        g.addColorStop(0, "rgba(255,255,255,0.04)");
        g.addColorStop(1, "rgba(0,0,0,0.18)");
        ctx.fillStyle = g;
        ctx.fillRect(0,0,W,H);

        // subtle stars
        ctx.fillStyle = "rgba(255,255,255,0.10)";
        for(let i=0;i<40;i++){
          const x = (i*97)%W;
          const y = (i*53)%groundY;
          ctx.fillRect(x, y, 2, 2);
        }

        // ground
        ctx.fillStyle = "rgba(0,0,0,0.22)";
        ctx.fillRect(0, groundY, W, H-groundY);
        ctx.strokeStyle = "rgba(255,255,255,0.10)";
        ctx.beginPath();
        ctx.moveTo(0, groundY);
        ctx.lineTo(W, groundY);
        ctx.stroke();
      }

      function drawPipes(){
        for(const p of pipes){
          // top
          ctx.fillStyle = "rgba(255,255,255,0.10)";
          ctx.strokeStyle = "rgba(255,255,255,0.14)";
          ctx.lineWidth = 2;

          const topRect = {x:p.x, y:0, w:p.w, h:p.topH};
          const botY = p.topH + p.gap;
          const botRect = {x:p.x, y:botY, w:p.w, h:groundY - botY};

          ctx.beginPath();
          roundRect(ctx, topRect.x, topRect.y, topRect.w, topRect.h, 14);
          ctx.fill();
          ctx.stroke();

          ctx.beginPath();
          roundRect(ctx, botRect.x, botRect.y, botRect.w, botRect.h, 14);
          ctx.fill();
          ctx.stroke();
        }
      }

      function drawPlayer(){
        // Label "dcop" above
        ctx.font = "800 18px ui-sans-serif, system-ui";
        ctx.fillStyle = "rgba(233,236,243,0.85)";
        ctx.textAlign = "center";
        ctx.fillText("dcop", player.x, player.y - 34);

        // Body (simple boy)
        // Head
        ctx.fillStyle = "rgba(255,255,255,0.90)";
        ctx.beginPath();
        ctx.arc(player.x, player.y - 14, 10, 0, Math.PI*2);
        ctx.fill();

        // Hair (dark)
        ctx.fillStyle = "rgba(20,20,25,0.90)";
        ctx.beginPath();
        ctx.arc(player.x, player.y - 17, 10, Math.PI*1.05, Math.PI*1.95);
        ctx.fill();

        // Jersey (white)
        ctx.fillStyle = "rgba(255,255,255,0.95)";
        ctx.strokeStyle = "rgba(0,0,0,0.12)";
        ctx.lineWidth = 2;
        ctx.beginPath();
        roundRect(ctx, player.x - 14, player.y - 4, 28, 28, 8);
        ctx.fill();
        ctx.stroke();

        // Number 27 (non-nego)
        ctx.fillStyle = "rgba(30,30,35,0.85)";
        ctx.font = "900 14px ui-sans-serif, system-ui";
        ctx.fillText("27", player.x, player.y + 14);

        // Legs
        ctx.strokeStyle = "rgba(255,255,255,0.70)";
        ctx.lineWidth = 3;
        ctx.beginPath();
        ctx.moveTo(player.x - 6, player.y + 24);
        ctx.lineTo(player.x - 6, player.y + 38);
        ctx.moveTo(player.x + 6, player.y + 24);
        ctx.lineTo(player.x + 6, player.y + 38);
        ctx.stroke();
      }

      function draw(){
        drawBackground();
        drawPipes();
        drawPlayer();
      }

      function step(t){
        if(!running) return;
        const dt = Math.min(0.033, (t - lastTime)/1000 || 0);
        lastTime = t;

        // physics
        player.vy += 900 * dt; // gravity
        player.y += player.vy * dt;

        // bounds
        if(player.y > groundY - 10){
          player.y = groundY - 10;
          lose();
          return;
        }
        if(player.y < 40){
          player.y = 40;
          player.vy = 0;
        }

        // spawn pipes
        spawnT += dt;
        if(spawnT > 1.2){
          spawnT = 0;
          spawnPipe();
        }

        // move pipes
        for(const p of pipes){
          p.x -= 220 * dt;
          // scoring
          if(!p.passed && p.x + p.w < player.x){
            p.passed = true;
            score++;
            scoreTxt.textContent = `${score}/11`;
            if(score >= 11){
              win();
              return;
            }
          }

          // collision
          const topHit = collideRectCircle(p.x, 0, p.w, p.topH, player.x, player.y, player.r);
          const botY = p.topH + p.gap;
          const botHit = collideRectCircle(p.x, botY, p.w, groundY - botY, player.x, player.y, player.r);
          if(topHit || botHit){
            lose();
            return;
          }
        }
        // cleanup
        pipes = pipes.filter(p => p.x > -120);

        draw();
        requestAnimationFrame(step);
      }

      function jump(){
        if(!running) return;
        player.vy = -340;
      }

      function start(){
        reset();
        running = true;
        lastTime = performance.now();

        // Start bgm when Start pressed (user gesture)
        safePlay(audio.bgm, {volume: 1, restart:false});

        draw();
        requestAnimationFrame(step);
      }

      function lose(){
        running = false;
        // simple reset prompt
        showOverlay("Oof. Try again?", "Retry", () => start());
      }

      function win(){
        running = false;
        gameWon = true;

        // Lower bgm by 50% AFTER game ends
        audio.bgm.volume = 0.5;

        showOverlay("Nice. You win. ðŸ˜ˆ", "Continue", () => renderWheel());
      }

      function showOverlay(title, btnText, onClick){
        const ov = document.createElement("div");
        ov.style.position="absolute";
        ov.style.inset="0";
        ov.style.display="flex";
        ov.style.alignItems="center";
        ov.style.justifyContent="center";
        ov.style.background="rgba(0,0,0,.35)";
        ov.style.backdropFilter="blur(4px)";
        ov.innerHTML = `
          <div style="width:min(360px, 88%); border-radius:18px; border:1px solid rgba(255,255,255,.16);
                      background: rgba(20,20,25,.60); padding:18px; text-align:center; box-shadow:0 20px 60px rgba(0,0,0,.35);">
            <div style="font-size:22px; font-weight:900; margin-bottom:12px;">${title}</div>
            <button class="btn" id="ovBtn" style="min-width:160px;">${btnText}</button>
          </div>
        `;
        document.querySelector(".gameWrap").appendChild(ov);
        ov.querySelector("#ovBtn").addEventListener("click", () => {
          ov.remove();
          onClick();
        });
      }

      // Input
      startBtn.addEventListener("click", start);
      canvas.addEventListener("click", () => {
        if(!running) return;
        jump();
      }, {passive:true});
      canvas.addEventListener("touchstart", (e) => {
        e.preventDefault();
        if(!running) return;
        jump();
      }, {passive:false});

      // Initial draw
      draw();
    }

    // ---------- WHEEL ----------
    function renderWheel(){
      current = "wheel";

      app.innerHTML = `
        <h1>Spin to win <span style="font-size:.7em">ðŸŽ¡</span></h1>
        <div class="sub" style="color:rgba(233,236,243,.75)">No backing out now.</div>

        <div class="wheelWrap">
          <div class="pointer"></div>
          <canvas id="wheelCanvas" width="420" height="420"></canvas>
        </div>

        <div class="center" style="margin-top:14px;">
          <button class="btn" id="spinBtn">SPIN</button>
        </div>
      `;

      const canvas = document.getElementById("wheelCanvas");
      const ctx = canvas.getContext("2d");
      const spinBtn = document.getElementById("spinBtn");

      const segments = [
        "WILD CARD",
        "DATE NIGHT PLANNING",
        "FREE MASSAGE FOR GF",
        "OMYUM RAMEN ON",
        "X MINS ONYX"
      ];

      // We will FORCE land on WILD CARD to guarantee
      const forcedIndex = 0;

      let angle = 0;
      let spinning = false;

      function drawWheel(){
        const W = canvas.width, H = canvas.height;
        const cx = W/2, cy = H/2;
        const rOuter = 190;
        const rInner = 46;
        const n = segments.length;
        const slice = (Math.PI*2)/n;

        ctx.clearRect(0,0,W,H);

        // Outer ring
        ctx.beginPath();
        ctx.arc(cx,cy,rOuter+8,0,Math.PI*2);
        ctx.strokeStyle="rgba(255,255,255,.14)";
        ctx.lineWidth=2;
        ctx.stroke();

        for(let i=0;i<n;i++){
          const a0 = angle + i*slice;
          const a1 = a0 + slice;

          // Segment fill
          ctx.beginPath();
          ctx.moveTo(cx,cy);
          ctx.arc(cx,cy,rOuter,a0,a1);
          ctx.closePath();

          ctx.fillStyle = (i%2===0) ? "rgba(255,255,255,.08)" : "rgba(255,255,255,.05)";
          ctx.fill();
          ctx.strokeStyle="rgba(255,255,255,.12)";
          ctx.lineWidth=2;
          ctx.stroke();

          // Text
          const mid = (a0+a1)/2;
          ctx.save();
          ctx.translate(cx,cy);
          ctx.rotate(mid);

          // We draw text centered along radial direction, keeping it readable
          const label = segments[i];
          const lines = wrapLabel(label, 14); // auto-wrap
          ctx.textAlign="center";
          ctx.fillStyle="rgba(233,236,243,.90)";
          ctx.font="900 16px ui-sans-serif, system-ui";
          const ty = -120;

          if(lines.length === 1){
            ctx.fillText(lines[0], 0, ty);
          }else{
            ctx.fillText(lines[0], 0, ty-10);
            ctx.fillText(lines[1], 0, ty+10);
          }

          ctx.restore();
        }

        // center hub
        ctx.beginPath();
        ctx.arc(cx,cy,rInner,0,Math.PI*2);
        ctx.fillStyle="rgba(0,0,0,.30)";
        ctx.fill();
        ctx.strokeStyle="rgba(255,255,255,.12)";
        ctx.lineWidth=2;
        ctx.stroke();
      }

      drawWheel();

      function angleForIndex(i){
        const n = segments.length;
        const slice = (Math.PI*2)/n;

        // Pointer is at top. We want chosen segment centered at top.
        const targetMid = -Math.PI/2; // top
        const segMid = i*slice + slice/2;
        return targetMid - segMid;
      }

      spinBtn.addEventListener("click", async () => {
        if(spinning) return;
        spinning = true;
        spinBtn.disabled = true;

        // wheel sound
        await safePlay(audio.spin, {volume: 1, restart:true});

        // animate spin and land on forcedIndex
        const base = angleForIndex(forcedIndex);
        const extraTurns = 6; // for drama
        const startA = angle;
        const endA = base + extraTurns*Math.PI*2;

        const dur = 3200;
        const t0 = performance.now();

        function easeOutCubic(x){ return 1 - Math.pow(1-x, 3); }

        function anim(t){
          const p = Math.min(1, (t - t0)/dur);
          angle = startA + (endA - startA) * easeOutCubic(p);
          drawWheel();
          if(p < 1){
            requestAnimationFrame(anim);
          }else{
            spinning = false;
            spinBtn.disabled = false;

            // stop spin sound
            safePause(audio.spin);

            // Confetti + button â€œWild card? Hmmmmâ€
            doConfetti(document.querySelector(".wheelWrap"));

            setTimeout(async () => {
              await playYay();
              showWildCardButton();
            }, 250);
          }
        }
        requestAnimationFrame(anim);
      });

      function showWildCardButton(){
        const c = document.querySelector(".wheelWrap");
        const holder = document.createElement("div");
        holder.className="center";
        holder.style.marginTop="14px";
        holder.innerHTML = `<button class="btn" id="wildBtn">Wild card? Hmmmm</button>`;
        c.insertAdjacentElement("afterend", holder);

        holder.querySelector("#wildBtn").addEventListener("click", () => {
          holder.remove();
          renderAha();
        });
      }
    }

    // ---------- AHA PAGE ----------
    function renderAha(){
      current = "aha";

      app.innerHTML = `
        <h1 style="font-size:40px">Aha! Thought you were lucky? Iâ€™m the luckier one.</h1>
        <div class="sub" style="color:rgba(233,236,243,.72)">Click to check your luck stats</div>

        <div class="center" style="margin-top:18px;">
          <button class="btn" id="luckBtn">Click to check your luck stats</button>
        </div>
      `;

      document.getElementById("luckBtn").addEventListener("click", () => {
        renderLuckPages();
      });
    }

    // ---------- LUCK PAGES (1-5) ----------
    function renderLuckPages(){
      current = "luck";

      // At this point: stop bgm completely, happy only
      safePause(audio.bgm);
      safePlay(audio.happy, {volume: 0.80, restart:false});

      app.innerHTML = `
        <h1 style="font-size:40px">ðŸ“Š Luck Stats Report</h1>
        <div class="sub" style="color:rgba(233,236,243,.72)">Swipe left/right.</div>

        <div class="pages" id="pages">
          <div class="pageInner" id="pageInner">
            ${luckPage("Luck stat: 1", "1 / 5")}
            ${luckPage("Luck stat increasingâ€¦ 2", "2 / 5")}
            ${luckPage("Luck stat increasing moreâ€¦ 3", "3 / 5")}
            ${luckPage("Luck stat increasing morerâ€¦ 4", "4 / 5")}
            ${luckPage("Luck stat increasing morerestâ€¦ 5", "5 / 5")}
          </div>
        </div>

        <div class="pager" id="pager">1 / 5</div>
      `;

      const inner = document.getElementById("pageInner");
      const pager = document.getElementById("pager");
      let idx = 0;

      function update(){
        inner.style.transform = `translateX(${-idx*100}%)`;
        pager.textContent = `${idx+1} / 5`;
      }

      // Swipe handling
      let startX = null;
      const pages = document.getElementById("pages");

      pages.addEventListener("touchstart", (e) => {
        startX = e.touches[0].clientX;
      }, {passive:true});

      pages.addEventListener("touchend", (e) => {
        if(startX === null) return;
        const endX = (e.changedTouches[0] || {}).clientX;
        const dx = endX - startX;
        startX = null;
        if(Math.abs(dx) < 40) return;
        if(dx < 0 && idx < 4) idx++;
        if(dx > 0 && idx > 0) idx--;
        update();
      }, {passive:true});

      // Desktop fallback
      pages.addEventListener("click", () => {
        if(idx < 4) idx++;
        else idx = 0;
        update();
      });

      update();
    }

    function luckPage(text, footer){
      return `
        <div class="page">
          <div class="bigStat">${text}</div>
        </div>
      `;
    }

    // ---------- Helpers ----------
    function roundRect(ctx, x, y, w, h, r){
      const rr = Math.min(r, w/2, h/2);
      ctx.moveTo(x+rr, y);
      ctx.arcTo(x+w, y, x+w, y+h, rr);
      ctx.arcTo(x+w, y+h, x, y+h, rr);
      ctx.arcTo(x, y+h, x, y, rr);
      ctx.arcTo(x, y, x+w, y, rr);
    }

    function wrapLabel(label, maxLen){
      // Return up to 2 lines, tries to break on spaces
      const words = label.split(" ");
      let line1 = "";
      let line2 = "";

      for(const w of words){
        const test = (line1 ? line1 + " " : "") + w;
        if(test.length <= maxLen){
          line1 = test;
        }else{
          line2 = (line2 ? line2 + " " : "") + w;
        }
      }

      if(!line2) return [line1];
      // If line2 still too long, hard cut (rare)
      if(line2.length > maxLen) line2 = line2.slice(0, maxLen-1) + "â€¦";
      return [line1, line2];
    }

    function doConfetti(container){
      const layer = document.createElement("div");
      layer.className = "confetti";
      container.appendChild(layer);

      const colors = ["#ff4d7d","#ffd166","#7bdff2","#b8f2a6","#cdb4ff"];
      for(let i=0;i<32;i++){
        const p = document.createElement("i");
        p.style.left = (Math.random()*100)+"%";
        p.style.top = (-20 - Math.random()*120)+"px";
        p.style.background = colors[i%colors.length];
        p.style.animationDelay = (Math.random()*120)+"ms";
        p.style.transform = `translateY(-60px) rotate(${Math.random()*90}deg)`;
        layer.appendChild(p);
      }
      setTimeout(()=> layer.remove(), 1100);
    }

    function niceEnvelopeSVG(){
      // A nicer envelope with subtle gradients + clean flap open animation.
      return `
      <svg width="300" height="300" viewBox="0 0 300 300" role="img" aria-label="Envelope"
           style="overflow:visible" data-open="0">
        <defs>
          <linearGradient id="g1" x1="0" x2="1">
            <stop offset="0" stop-color="rgba(255,255,255,.18)"/>
            <stop offset="1" stop-color="rgba(255,255,255,.08)"/>
          </linearGradient>
          <linearGradient id="g2" x1="0" x2="0" y1="0" y2="1">
            <stop offset="0" stop-color="rgba(0,0,0,.10)"/>
            <stop offset="1" stop-color="rgba(0,0,0,.28)"/>
          </linearGradient>
          <filter id="sh" x="-20%" y="-20%" width="140%" height="140%">
            <feDropShadow dx="0" dy="12" stdDeviation="10" flood-color="rgba(0,0,0,.35)"/>
          </filter>
        </defs>

        <!-- Back plate -->
        <rect x="30" y="70" width="240" height="170" rx="26"
              fill="rgba(0,0,0,.18)" stroke="rgba(255,255,255,.14)" filter="url(#sh)"/>

        <!-- Envelope body -->
        <g transform="translate(0,0)">
          <rect x="55" y="110" width="190" height="120" rx="18"
                fill="url(#g2)" stroke="rgba(255,255,255,.18)" stroke-width="2"/>

          <!-- X lines -->
          <path d="M65 120 L150 185 L235 120" fill="none" stroke="rgba(255,255,255,.20)" stroke-width="2"/>
          <path d="M65 220 L150 155 L235 220" fill="none" stroke="rgba(255,255,255,.14)" stroke-width="2"/>

          <!-- Flap (animated) -->
          <g id="flap" transform-origin="150px 122px"
             style="transition: transform 320ms cubic-bezier(.2,.9,.2,1)">
            <path d="M65 120 L150 70 L235 120 Z"
                  fill="url(#g1)" stroke="rgba(255,255,255,.22)" stroke-width="2"/>
          </g>

          <!-- Heart seal -->
          <g transform="translate(150,205)">
            <path d="M0 18
                     C-18 6 -26 -8 -12 -18
                     C-4 -24 0 -18 0 -14
                     C0 -18 4 -24 12 -18
                     C26 -8 18 6 0 18 Z"
                  fill="#ff4d7d" opacity=".95"/>
            <path d="M0 18
                     C-18 6 -26 -8 -12 -18
                     C-4 -24 0 -18 0 -14
                     C0 -18 4 -24 12 -18
                     C26 -8 18 6 0 18 Z"
                  fill="none" stroke="rgba(255,255,255,.25)" stroke-width="2"/>
          </g>
        </g>

        <style>
          svg[data-open="1"] #flap { transform: rotateX(65deg) translateY(-6px); }
        </style>
      </svg>`;
    }

    // ---------- Start ----------
    renderMail();
  </script>
</body>
</html>
